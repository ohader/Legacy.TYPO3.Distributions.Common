<?xml version="1.0" encoding="UTF-8"?>
<!--
 * This script belongs to the TYPO3 v4 build system.                      *
 *                                                                        *
 * It is free software; you can redistribute it and/or modify it under    *
 * the terms of the GNU Lesser General Public License as published by the *
 * Free Software Foundation, either version 3 of the License, or (at your *
 * option) any later version.                                             *
 *                                                                        *
 * This script is distributed in the hope that it will be useful, but     *
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHAN-    *
 * TABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser       *
 * General Public License for more details.                               *
 *                                                                        *
 * You should have received a copy of the GNU Lesser General Public       *
 * License along with the script.                                         *
 * If not, see http://www.gnu.org/licenses/lgpl.html                      *
 *                                                                        *
 * The TYPO3 project - inspiring people to share!                         *
-->
<project name="TYPO3v4Build" basedir="." default="build">
	<property name="common.baseDir" value="" override="true" />
	<property name="common.taskPrefix" value="" override="true" />

	<property name="git.distributionsRepositoryBase" value="git://git.typo3.org/TYPO3v4/Distributions/" />
	<property name="project.distributionsDirectory" value="${project.basedir}/Distributions/" />
	<property name="project.distributions" value="Base,Blank,Introduction" />

	<import file="${project.basedir}/${common.baseDir}Build/common.xml" />
	<property name="common.isLoaded" value="true" override="true" />

	<target name="build">
		<phingcall target="build-initialize" />
	</target>

	<target name="build-initialize">
		<delete dir="${project.distributionsDirectory}" quiet="true" />
		<mkdir dir="${project.distributionsDirectory}" />

		<foreach list="${project.distributions}" param="build-fetch-distribution.name" target="build-fetch-distribution" />
	</target>

	<target name="build-fetch-distribution">
		<fail unless="build-fetch-distribution.name" message="Parameter $build-fetch-distribution.name is required" />

		<exec logoutput="true" checkreturn="true"
			command="git clone ${git.distributionsRepositoryBase}${build-fetch-distribution.name}.git ${project.distributionsDirectory}${build-fetch-distribution.name}/" />

		<import file="${project.distributionsDirectory}${build-fetch-distribution.name}/Build/build.xml" />
	</target>
</project>
